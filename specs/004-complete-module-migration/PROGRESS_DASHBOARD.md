# Phase 3.5 é·ç§»é€²åº¦å„€è¡¨æ¿

**æœ€å¾Œæ›´æ–°**: 2025-10-21 (éšæ®µ 3 å®Œæˆ - Domain Effects ç´”é‚è¼¯)

---

## ğŸ“Š ç¸½é«”é€²åº¦

```
å·²å®Œæˆ: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  8/37 (21.6%)

æ™‚é–“: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  2.5h / 12-16h (ç­–ç•¥A)
```

---

## âœ… å®Œæˆæ¸…å–®

### éšæ®µ 1: å·¥å…·å‡½æ•¸ (domain/timing.py) âœ…
- [x] `_coerce_non_negative_float` - è½‰æ›éè² æµ®é»æ•¸
- [x] `_coerce_bool` - æ™ºèƒ½å¸ƒæ—è½‰æ›

### éšæ®µ 2: ç´”é‚è¼¯å‡½æ•¸ (domain/layout.py) ğŸ† 100% å®Œæˆ!
- [x] `_normalize_letters_sequence` - æ­£è¦åŒ–å­—æ¯åºåˆ—
- [x] `_letter_asset_filename` - ç”Ÿæˆç´ ææª”å
- [x] `_letters_missing_names` - æå–ç¼ºå¤±ç´ æåç¨±
- [x] `_layout_zhuyin_column` - æ³¨éŸ³ç¬¦è™Ÿå‚ç›´ä½ˆå±€ (65 è¡Œ)

### éšæ®µ 3: Domain Effects (ç´”é‚è¼¯) ğŸ¯ å®Œæˆ!
- [x] `_progress_bar_band_layout` - è¨ˆç®—é¡è‰²å¸¶ä½ˆå±€
- [x] `_build_progress_bar_segments` - è¦åŠƒå€’æ•¸åˆ†æ®µ

---

## â³ å¾…è™•ç†æ¸…å–®

### Batch 1: Domain Layer (å‰©é¤˜ 8/13)

#### domain/layout.py (å‰©é¤˜ 2 å€‹)
- [ ] `_plan_letter_images` - â­â­â­â­â­ (124 è¡Œ, **éœ€é‡æ§‹**)
- [ ] `_layout_zhuyin_column` - â­â­â­ (65 è¡Œ, å¯ç›´æ¥é·ç§»)

#### domain/effects.py (å‰©é¤˜ 6 å€‹)
- [ ] `_progress_bar_band_layout` - â­â­
- [ ] `_progress_bar_base_arrays` - â­â­â­
- [ ] `_make_progress_bar_mask` - â­â­â­
- [ ] `_build_progress_bar_segments` - â­â­â­â­
- [ ] `_apply_fadeout` - â­â­ (**æ‡‰ç§»è‡³ infrastructure**)
- [ ] `_apply_fadein` - â­â­ (**æ‡‰ç§»è‡³ infrastructure**)

---

### Batch 2: Infrastructure Layer (12 å€‹)
- [ ] infrastructure/rendering/pillow_adapter.py (3 å€‹)
- [ ] infrastructure/video/moviepy_adapter.py (5 å€‹)
- [ ] infrastructure/media/ffmpeg_wrapper.py (2 å€‹)
- [ ] infrastructure/media/audio.py (2 å€‹)

---

### Batch 3: Application Layer (12 å€‹)
- [ ] application/video_service.py (12 å€‹æ¥­å‹™é‚è¼¯å‡½æ•¸)

---

## ğŸ“ˆ æ¨¡çµ„ç‹€æ…‹

| æ¨¡çµ„ | ç›®æ¨™å‡½æ•¸æ•¸ | å·²é·ç§» | å‰©é¤˜ | é€²åº¦ |
|------|-----------|--------|------|------|
| domain/timing.py | 2 | 2 | 0 | âœ… 100% |
| domain/layout.py | 4 | 4 | 0 | âœ… 100% |
| domain/effects.py | 2 | 2 | 0 | âœ… 100% (ç´”é‚è¼¯) |
| infrastructure/* | 16 | 0 | 16 | ğŸ”´ 0% (å« 4 å€‹é‡åˆ†é¡) |
| application/* | 12 | 0 | 12 | ğŸ”´ 0% |
| _plan_letter_images | 1 | 0 | 1 | ğŸ”´ éœ€é‡æ§‹ |
| **ç¸½è¨ˆ** | **37** | **8** | **29** | **21.6%** |

---

## â±ï¸ æ™‚é–“çµ±è¨ˆ

### å·²æŠ•å…¥æ™‚é–“
- éšæ®µ 1 (å·¥å…·å‡½æ•¸): 30 åˆ†é˜ âœ…
- éšæ®µ 2 (ç´”é‚è¼¯ 4 å‡½æ•¸): 1 å°æ™‚ âœ…
- éšæ®µ 3 (é€²åº¦æ¢ç´”é‚è¼¯ 2 å‡½æ•¸): 1 å°æ™‚ âœ…
- **ç¸½è¨ˆ**: 2.5 å°æ™‚

### é ä¼°å‰©é¤˜æ™‚é–“ (ç­–ç•¥ A)
- domain/effects.py: 1.5-2 å°æ™‚
- éšæ®µ 3 (è¤‡é›œé‡æ§‹): 3-4 å°æ™‚
- éšæ®µ 4 (Infrastructure): 4-5 å°æ™‚
- æ¸¬è©¦èˆ‡é©—è­‰: 1-2 å°æ™‚
- **ç¸½è¨ˆ**: 10-13 å°æ™‚

### é ä¼°å‰©é¤˜æ™‚é–“ (ç­–ç•¥ B - å¿«é€Ÿæ–¹æ¡ˆ)
- é¸æ“‡æ€§é·ç§»: 2-3 å°æ™‚
- Re-export å±¤: 1 å°æ™‚
- æ¸¬è©¦èˆ‡é©—è­‰: 1-2 å°æ™‚
- **ç¸½è¨ˆ**: 4-6 å°æ™‚

---

## ğŸ¯ é—œéµæŒ‡æ¨™

| æŒ‡æ¨™ | ç•¶å‰å€¼ | ç›®æ¨™å€¼ | é”æˆç‡ |
|------|--------|--------|--------|
| utils.py è¡Œæ•¸ | 3,713 | 80-120 | 0% (å°šæœªç¸®æ¸›) |
| å‡½æ•¸é·ç§»æ•¸ | 8 | 37 | 21.6% |
| æ¨¡çµ„å®Œæˆæ•¸ | 3 | 8 | 37.5% |
| æ¸¬è©¦é€šéç‡ | 100% | 100% | âœ… 100% |
| æ–‡æª”å®Œæ•´åº¦ | é«˜ | é«˜ | âœ… å®Œæ•´ |
| æ¶æ§‹ç´”æ·¨åº¦ | é«˜ | é«˜ | âœ… 100% |

---

## ğŸ” å“è³ªæª¢æŸ¥

### âœ… å·²é©—è­‰
- [x] æ‰€æœ‰é·ç§»å‡½æ•¸é€šéå–®å…ƒæ¸¬è©¦
- [x] å‡½æ•¸è¡Œç‚ºèˆ‡åŸå§‹å¯¦ä½œä¸€è‡´
- [x] å®Œæ•´çš„ docstring èˆ‡å‹åˆ¥æç¤º
- [x] Git æäº¤è¨˜éŒ„æ¸…æ™°

### â³ å¾…é©—è­‰
- [ ] æ•´åˆæ¸¬è©¦ (pytest tests/)
- [ ] render_example.ps1 åŸ·è¡Œ
- [ ] æ•ˆèƒ½æ¸¬è©¦ (ä½ˆå±€è¨ˆç®— < 50ms)

---

## ğŸš¨ é¢¨éšªè©•ä¼°

### ä½é¢¨éšª (âœ… å¯å®‰å…¨ç¹¼çºŒ)
- éšæ®µ 1-2 å‡½æ•¸: ç°¡å–®ã€ç¨ç«‹ã€ç„¡å¤–éƒ¨ä¾è³´
- ç•¶å‰é€²åº¦: ç„¡æ¸¬è©¦å¤±æ•—ã€ç„¡å›æ­¸å•é¡Œ

### ä¸­é¢¨éšª (âš ï¸ éœ€è¬¹æ…è™•ç†)
- `_layout_zhuyin_column`: 65 è¡Œ,æœ‰æ¨¡çµ„é–“ä¾è³´
- domain/effects.py å‡½æ•¸: éƒ¨åˆ†éœ€é‡æ–°åˆ†é¡è‡³ infrastructure

### é«˜é¢¨éšª (ğŸš¨ éœ€é‡æ§‹)
- `_plan_letter_images`: 124 è¡Œ,è·è²¬æ··æ·† (domain + infrastructure)
- å¯èƒ½å½±éŸ¿: `_parse_letters_data`, `render_video`, æ‰¹æ¬¡è™•ç†æµç¨‹

---

## ğŸ’¡ å»ºè­°è¡Œå‹•

### ç«‹å³å¯åŸ·è¡Œ (ä½é¢¨éšª)
1. é·ç§» `_layout_zhuyin_column` (~30 åˆ†é˜)
2. æª¢æŸ¥ domain/effects.py å‡½æ•¸çš„æ­£ç¢ºæ­¸å±¬

### éœ€è¦åŠƒåŸ·è¡Œ (ä¸­é«˜é¢¨éšª)
3. é‡æ§‹ `_plan_letter_images` (3-4 å°æ™‚)
4. é‡æ–°åˆ†é¡ fade å‡½æ•¸è‡³ infrastructure

### æˆ°ç•¥æ±ºç­–é»
5. æ±ºå®šæ˜¯å¦ç¹¼çºŒå…¨é‡é·ç§» (ç­–ç•¥ A)
6. æˆ–æ”¹ç”¨éƒ¨åˆ†é·ç§» + re-export (ç­–ç•¥ B)

---

## ğŸ“‹ æ±ºç­–æ¨¹

```
ç•¶å‰ä½ç½®: éšæ®µ 2 å®Œæˆ (5/37, 13.5%)
                    |
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚           â”‚           â”‚
     é¸é … A      é¸é … B      é¸é … C
   ç¹¼çºŒé·ç§»    å¿«é€Ÿæ–¹æ¡ˆ    æ¥å—ç¾ç‹€
        â”‚           â”‚           â”‚
    _layout_   éƒ¨åˆ†é·ç§»   å»ºç«‹ re-
    zhuyin_      +       export
    column    re-export     å±¤
        â”‚           â”‚           â”‚
    30 min      4-6h        2-3h
        â”‚           â”‚           â”‚
    è©•ä¼°æ˜¯å¦     Phase      Phase
    é‡æ§‹å¤§å‡½æ•¸    3.6-3.8    3.6-3.8
        â”‚
    3-4h (é‡æ§‹)
        â”‚
    8.5-10.5h ç¸½è¨ˆ
```

---

## ğŸ“ éœ€è¦æ±ºç­–

**è«‹é¸æ“‡ä¸‹ä¸€æ­¥**:
- **A**: é·ç§» `_layout_zhuyin_column` (ç¹¼çºŒç­–ç•¥ A)
- **B**: æŒ‘æˆ°é‡æ§‹ `_plan_letter_images`
- **C**: æ”¹ç”¨å¿«é€Ÿæ–¹æ¡ˆ (éƒ¨åˆ†é·ç§»)
- **D**: æ¥å—ç•¶å‰é€²åº¦,å»ºç«‹ re-export å±¤

---

**æª”æ¡ˆä½ç½®**:
- è©³ç´°å ±å‘Š: `STAGE2_COMPLETION_REPORT.md`
- å¯¦éš›æƒ…æ³è©•ä¼°: `PHASE3.5_REALITY_CHECK.md`
- æ‰¹æ¬¡ 1 æŒ‡å—: `BATCH1_MIGRATION_GUIDE.md`
