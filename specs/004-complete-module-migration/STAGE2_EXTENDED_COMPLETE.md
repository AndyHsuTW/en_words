# éšæ®µ 2 å»¶ä¼¸å®Œæˆå ±å‘Š

**æ—¥æœŸ**: 2025-10-20  
**ç‹€æ…‹**: âœ… domain/layout.py 100% å®Œæˆ  
**ç¸½è€—æ™‚**: ~1.5 å°æ™‚

---

## ğŸ‰ é‡è¦é‡Œç¨‹ç¢‘

### domain/layout.py æ¨¡çµ„é·ç§»å®Œæˆ!

æˆåŠŸå°‡ **5 å€‹å‡½æ•¸**å¾ `utils.py` é·ç§»è‡³ `domain/layout.py`:

| # | å‡½æ•¸ | è¡Œæ•¸ | è¤‡é›œåº¦ | ç‹€æ…‹ |
|---|------|------|--------|------|
| 1 | `_normalize_letters_sequence` | 9 | â­ | âœ… |
| 2 | `_letter_asset_filename` | 8 | â­ | âœ… |
| 3 | `_letters_missing_names` | 7 | â­ | âœ… |
| 4 | `_layout_zhuyin_column` | 65 | â­â­â­ | âœ… |
| **ç¸½è¨ˆ** | **4 å€‹å‡½æ•¸** | **89 è¡Œ** | - | **100%** |

---

## ğŸ“Š ç¸½é«”é€²åº¦æ›´æ–°

### å·²å®Œæˆé·ç§»

| æ¨¡çµ„ | å‡½æ•¸æ•¸ | ç‹€æ…‹ | æäº¤ |
|------|--------|------|------|
| domain/timing.py | 2 | âœ… 100% | 61fd9e2 |
| **domain/layout.py** | **4** | **âœ… 100%** | **1aeb0d1, ad01031** |

**ç¸½é€²åº¦**: 6/37 å‡½æ•¸ (16.2%)

---

## âœ… æœ€æ–°é·ç§»: _layout_zhuyin_column

### å‡½æ•¸è³‡è¨Š
- **ä½ç½®**: `domain/layout.py` (line ~427)
- **åŠŸèƒ½**: è¨ˆç®—æ³¨éŸ³ç¬¦è™Ÿç›´è¡Œçš„å‚ç›´ä½ç½®ä½ˆå±€
- **è¤‡é›œåº¦**: â­â­â­ (ä¸­ç­‰è¤‡é›œ)
- **è¡Œæ•¸**: 65 è¡Œ (å«æ–‡æª” 131 è¡Œ)

### é—œéµç‰¹æ€§
1. **è¼•è²ç‰¹æ®Šè™•ç†**: è¼•è²ç¬¦è™Ÿ(Ë™)ç½®æ–¼ä¸»è¦ç¬¦è™Ÿä¸Šæ–¹,å±…ä¸­å°é½Š
2. **ä¸€èˆ¬è²èª¿è™•ç†**: å…¶ä»–è²èª¿ç½®æ–¼ä¸»è¦ç¬¦è™Ÿå³å´,å‚ç›´ç½®ä¸­
3. **é‚Šç•Œæª¢æŸ¥**: ç¢ºä¿æ‰€æœ‰å…ƒç´ ä¸è¶…å‡ºå¯ç”¨é«˜åº¦

### é©—è­‰çµæœ âœ…

```python
# æ¸¬è©¦ 1: ä¸€èˆ¬è²èª¿ - å³å´å‚ç›´ç½®ä¸­
_layout_zhuyin_column(cursor_y=100, col_h=200, total_main_h=80,
                      tone_syms=["ËŠ"], tone_sizes=[(10, 15)])
# âœ… tone_alignment == "right", tone_start_y == 140

# æ¸¬è©¦ 2: è¼•è² - ä¸Šæ–¹å±…ä¸­
_layout_zhuyin_column(cursor_y=100, col_h=200, total_main_h=80,
                      tone_syms=["Ë™"], tone_sizes=[(10, 12)])
# âœ… tone_alignment == "center", main_start_y == 122

# æ¸¬è©¦ 3: ç„¡è²èª¿
_layout_zhuyin_column(cursor_y=100, col_h=200, total_main_h=80,
                      tone_syms=[], tone_sizes=[])
# âœ… tone_start_y is None
```

---

## ğŸ“ˆ Batch 1 (Domain Layer) é€²åº¦

```
å·²å®Œæˆ: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  6/13 (46%)
```

### å·²å®Œæˆæ¨¡çµ„
- âœ… domain/timing.py (2/2, 100%)
- âœ… domain/layout.py (4/4, 100%)

### å¾…è™•ç†æ¨¡çµ„
- â³ domain/effects.py (0/6, 0%)
- âš ï¸ _plan_letter_images (éœ€é‡æ§‹,æš«æœªåŒ…å«åœ¨ä¸Šè¿°çµ±è¨ˆ)

---

## ğŸ¯ é—œéµç™¼ç¾

### âœ… æˆåŠŸå› ç´ 

1. **å‡½æ•¸ç¨ç«‹æ€§é«˜**
   - `_layout_zhuyin_column` é›–ç„¶æœ‰ 65 è¡Œ,ä½†ç„¡å¤–éƒ¨ä¾è³´
   - ç´”è¨ˆç®—é‚è¼¯,æ˜“æ–¼æ¸¬è©¦èˆ‡é©—è­‰

2. **æ–‡æª”å®Œæ•´**
   - è©³ç´°çš„ docstring èªªæ˜åƒæ•¸èˆ‡è¿”å›å€¼
   - åŒ…å«ä½¿ç”¨ç¯„ä¾‹èˆ‡é‚Šç•Œæƒ…æ³è™•ç†

3. **é©—è­‰å¿«é€Ÿ**
   - Pylance MCP ç›´æ¥åŸ·è¡Œæ¸¬è©¦
   - 3 å€‹æ¸¬è©¦æ¡ˆä¾‹è¦†è“‹ä¸»è¦å ´æ™¯

---

### âš ï¸ ä¸‹ä¸€æ­¥æŒ‘æˆ°

#### å‰©é¤˜ Batch 1 å‡½æ•¸åˆ†æ

| æ¨¡çµ„ | å‡½æ•¸ | ç‹€æ…‹ | æŒ‘æˆ° |
|------|------|------|------|
| **domain/effects.py** | `_progress_bar_*` (4å€‹) | å¾…é·ç§» | ä½¿ç”¨ numpy arrays |
| | `_apply_fadeout` | âŒ èª¤åˆ†é¡ | ä½¿ç”¨ MoviePy,æ‡‰å±¬ infrastructure |
| | `_apply_fadein` | âŒ èª¤åˆ†é¡ | ä½¿ç”¨ MoviePy,æ‡‰å±¬ infrastructure |
| **æœªæ­¸é¡** | `_plan_letter_images` | éœ€é‡æ§‹ | 124è¡Œ,æ··åˆ domain + infrastructure |

---

## ğŸ’¡ ç­–ç•¥å»ºè­°

### é¸é … A: ç¹¼çºŒ domain/effects.py (æ¨è–¦)
é·ç§» 4 å€‹ progress bar å‡½æ•¸ (`_progress_bar_*`)

**å„ªé»**:
- âœ… è·è²¬ç›¸å°å–®ç´” (é›–ç„¶ä½¿ç”¨ numpy)
- âœ… å‡½æ•¸é–“æœ‰æ¸…æ™°çš„å‘¼å«é—œä¿‚
- âœ… é ä¼° 1.5-2h

**éœ€è¦**:
- æª¢æŸ¥æ˜¯å¦éœ€è¦æ·»åŠ  numpy å°å…¥
- é©—è­‰å‡½æ•¸é–“çš„ä¾è³´é—œä¿‚

---

### é¸é … B: é‡æ–°åˆ†é¡ fade å‡½æ•¸
å°‡ `_apply_fadeout` èˆ‡ `_apply_fadein` ç§»è‡³ `infrastructure/video/effects.py`

**å„ªé»**:
- âœ… æ›´æ­£æ¶æ§‹åˆ†é¡
- âœ… å‡½æ•¸ç›¸å°ç°¡å–® (~20-30 è¡Œ)
- âœ… é ä¼° 1h

**éœ€è¦**:
- å¯èƒ½éœ€è¦å‰µå»ºæ–°æ¨¡çµ„ `infrastructure/video/effects.py`
- æ›´æ–° MIGRATION_MAPPING.json

---

### é¸é … C: æŒ‘æˆ°é‡æ§‹ _plan_letter_images
æ‹†åˆ† 124 è¡Œè¤‡é›œå‡½æ•¸ç‚º domain + infrastructure

**å„ªé»**:
- âœ… å®Œæˆæœ€å¤§æŒ‘æˆ°
- âœ… æ¸…ç†æ¶æ§‹å‚µå‹™

**ç¼ºé»**:
- âš ï¸ é«˜é¢¨éšª (3-4h, å¯èƒ½å½±éŸ¿æ¸¬è©¦)
- âš ï¸ éœ€è¦è©³ç´°è¦åŠƒ

---

### é¸é … D: æš«åœä¸¦åˆ‡æ›ç­–ç•¥
æ¥å—ç•¶å‰é€²åº¦ (6/37),è·³åˆ° Phase 3.6 å»ºç«‹ re-export å±¤

**å„ªé»**:
- âœ… å¿«é€Ÿå®Œæˆ (2-3h)
- âœ… ä½é¢¨éšª

**ç¼ºé»**:
- âš ï¸ æœªé”æˆã€Œå®Œå…¨ç§»é™¤ã€ç›®æ¨™
- âš ï¸ utils.py ä»ä¿ç•™å¤§é‡ä»£ç¢¼

---

## â±ï¸ æ™‚é–“çµ±è¨ˆ

### å·²æŠ•å…¥
- éšæ®µ 1: 30 åˆ†é˜ âœ…
- éšæ®µ 2: 1 å°æ™‚ âœ…
- **ç¸½è¨ˆ**: 1.5 å°æ™‚

### é ä¼°å‰©é¤˜ (ç­–ç•¥ A - æ¼¸é€²å¼é·ç§»)
- domain/effects.py: 1.5-2h
- é‡æ§‹è¤‡é›œå‡½æ•¸: 3-4h
- Infrastructure: 4-5h
- æ¸¬è©¦é©—è­‰: 1-2h
- **ç¸½è¨ˆ**: 9.5-13h

### é ä¼°å‰©é¤˜ (å¿«é€Ÿæ–¹æ¡ˆ)
- é¸æ“‡æ€§é·ç§»: 2-3h
- Re-export å±¤: 1h
- æ¸¬è©¦é©—è­‰: 1-2h
- **ç¸½è¨ˆ**: 4-6h

---

## ğŸ“‹ æ±ºç­–æ™‚é–“

**æ‚¨å¸Œæœ›**:

**A.** ç¹¼çºŒé·ç§» domain/effects.py progress bar å‡½æ•¸ (1.5-2h)  
**B.** é‡æ–°åˆ†é¡ fade å‡½æ•¸è‡³ infrastructure (1h)  
**C.** æŒ‘æˆ°é‡æ§‹ _plan_letter_images (3-4h)  
**D.** åˆ‡æ›è‡³å¿«é€Ÿæ–¹æ¡ˆ,å»ºç«‹ re-export å±¤ (4-6h)

---

## æäº¤è¨˜éŒ„

```
commit ad01031
feat: é·ç§» _layout_zhuyin_column è‡³ domain/layout.py

éšæ®µ 2 å»¶ä¼¸å®Œæˆ:
- _layout_zhuyin_column (65è¡Œ,æ³¨éŸ³ç¬¦è™Ÿå‚ç›´ä½ˆå±€)
- æ·»åŠ  Dict, Any å‹åˆ¥å°å…¥
- å®Œæ•´ docstring èˆ‡æ¸¬è©¦é©—è­‰

æ‰¹æ¬¡ 1 (Domain Layer) é€²åº¦: 6/13 (46%)
```

---

**ç•¶å‰æˆå°±**: ğŸ† domain/layout.py æ¨¡çµ„ 100% å®Œæˆ!  
**ç¸½é€²åº¦**: 6/37 (16.2%)  
**æ™‚é–“æŠ•å…¥**: 1.5h / é ä¼° 11-14.5h ç¸½è¨ˆ
